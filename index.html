<!DOCTYPE html>
<html lang="ht">
<head>
    <link rel="icon" type="image/png" href="logo.png">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>LAVRI ZETWAL | Pi pw√≤p, pi santi bon</title>
    <link rel="stylesheet" href="style.css">
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;600;800&family=Playfair+Display:wght@700&display=swap" rel="stylesheet">
</head>
<body>
    <div id="bubble-container"></div>
    <div id="star-container" class="star-field"></div>

    <nav class="nav">
        <div class="container nav-content">
            <a href="https://wa.me/79961103506" class="wa-icon-btn">
                <img src="https://upload.wikimedia.org/wikipedia/commons/6/6b/WhatsApp.svg" alt="WA" class="wa-img">
            </a>
            
            <ul class="nav-links">
                <li><a href="index.html" class="active">Ak√®y</a></li>
                <li><a href="services.html">S√®vis</a></li>
                <li><a href="tarifs.html">Tarif</a></li>
            </ul>
            <div class="logo-container">
    <img src="logo.png" alt="Zetwal" class="nav-logo-icon">
    <div class="logo-text">LAVRI <span>ZETWAL</span></div>
            </div>
    </nav>

    <header class="hero">
        <div class="container">
            <div class="hero-content">
                <span class="location-badge-gold">Gonayiv ‚Ä¢ Enpas 3e Riy√®l Yamoul #5</span>
                <h1 class="main-title">Pi pw√≤p, <br><span class="gold-shimmer-extreme">pi santi bon.</span></h1>
                <p class="gold-text-sub-glow">Lave pi rapid san traka</p>
                <div class="hero-cta">
                    <a href="https://wa.me/79961103506" class="btn-main-gold">k√≤mande lavaj ou kounye a</a>
                </div>
            </div>
        </div>
    </header>

    <section class="gallery-prestige">
        <div class="container">
            <div class="image-showcase">
                <div class="img-wrapper">
                    <img src="machine.jpg" alt="Machin Lavri Zetwal">
                    <div class="img-overlay">10 Machin 22Kg Disponib</div>
                </div>
            </div>
        </div>
    </section>
<script type="module">
  // 1. Imports propres et unifi√©s (Version stable)
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
  import { getAuth, signInWithPopup, GoogleAuthProvider, signOut, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-auth.js";
  import { getFirestore, doc, getDoc, setDoc, updateDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js";

  // 2. Ta configuration officielle
  const firebaseConfig = {
    apiKey: "AIzaSyAjCnmtvu0tqlsNDEtKraKBG79y12qYeCQ",
    authDomain: "lavrizetwal.firebaseapp.com",
    projectId: "lavrizetwal",
    storageBucket: "lavrizetwal.firebasestorage.app",
    messagingSenderId: "291921316186",
    appId: "1:291921316186:web:f55e8b34526960df394b63",
    measurementId: "G-65R9V5MRBV"
  };

  // 3. Initialisation
  const app = initializeApp(firebaseConfig);
  const auth = getAuth(app);
  const db = getFirestore(app);

  let playerData, gameActive = false, time = 60, weight = 0, errors = 0;
  let usedColors = new Set(), timer, sessionHistory = [];

  const clothes = [
    {e:"üëï", w:2, c:"white", cl:"is-white", n:"Blan"},
    {e:"üëï", w:2.5, c:"black", cl:"is-black", n:"Nwa"},
    {e:"üëó", w:4, c:"color", cl:"is-green", n:"Koul√®"},
    {e:"üß¶", w:1, c:"white", cl:"is-white", n:"Blan"},
    {e:"üëö", w:3, c:"color", cl:"is-blue", n:"Koul√®"}
  ];

  // 4. Gestion de l'utilisateur (Le coeur du probl√®me)
  onAuthStateChanged(auth, async (user) => {
    const statusText = document.getElementById("user-status");
    const loginBtn = document.getElementById("login-methods");
    const statsDiv = document.getElementById("player-stats");
    const gameSec = document.getElementById("game-section");

    if (user) {
      statusText.textContent = "Chajman done...";
      try {
        const ref = doc(db, "users", user.uid);
        let snap = await getDoc(ref);

        if (!snap.exists()) {
          await setDoc(ref, { points: 100, created: serverTimestamp() });
          snap = await getDoc(ref);
        }

        playerData = snap.data();

        // Mise √† jour de l'interface
        loginBtn.style.display = "none";
        statusText.innerHTML = `Byenvini <b style="color:#ffd700">${user.displayName}</b>`;
        document.getElementById("balance").textContent = playerData.points;
        statsDiv.style.display = "block";
        gameSec.style.opacity = "1";
        gameSec.style.pointerEvents = "auto";
        document.getElementById("game-ui").style.display = "block";
        if(document.getElementById("lock-msg")) document.getElementById("lock-msg").style.display = "none";
        
        resetGame();
      } catch (e) {
        console.error(e);
        statusText.textContent = "Er√® koneksyon baz done";
      }
    } else {
      statusText.textContent = "Konekte w pou w jwe";
      loginBtn.style.display = "block";
      statsDiv.style.display = "none";
      gameSec.style.opacity = "0.4";
    }
  });

  // 5. Fonctions du Jeu
  function generateCloth() {
    const d = clothes[Math.floor(Math.random()*clothes.length)];
    const container = document.getElementById("clothes-conveyor");
    if(!container) return;
    
    const wrap = document.createElement("div");
    const btn = document.createElement("button");
    btn.className = `cloth-btn ${d.cl}`;
    btn.innerHTML = `<span class="emoji">${d.e}</span><small>${d.w}kg</small>`;
    
    btn.onclick = () => {
      if(!gameActive) startGame();
      weight += d.w;
      const isErr = (d.c==="white" && (usedColors.has("color") || usedColors.has("black"))) || (usedColors.has("white") && d.c!=="white");
      if(isErr) errors++;
      usedColors.add(d.c);
      sessionHistory.push({d, isErr});
      wrap.remove(); generateCloth();
    };

    const skip = document.createElement("button");
    skip.className = "change-btn"; skip.textContent = "üîÑ";
    skip.onclick = () => { wrap.remove(); generateCloth(); };

    wrap.append(btn, skip);
    container.appendChild(wrap);
  }

  function startGame() {
    gameActive = true;
    timer = setInterval(() => {
      time--; 
      const timerEl = document.getElementById("game-timer");
      if(timerEl) timerEl.textContent = `‚è±Ô∏è ${time}s`;
      if(time <= 0) finalize(false);
    }, 1000);
  }

  async function finalize(success) {
    clearInterval(timer);
    let gain = -3;
    if(success) gain = (errors===0?10:(errors===1?5:3));
    
    playerData.points += gain;
    await updateDoc(doc(db,"users",auth.currentUser.uid), {points:playerData.points});
    
    document.getElementById("balance").textContent = playerData.points;
    document.getElementById("report-modal").style.display = "flex";
    document.getElementById("report-details").innerHTML = `Pwa: ${weight.toFixed(1)}kg | Er√®: ${errors} | Gain: ${gain} pts`;
    resetGame();
  }

  function resetGame() {
    gameActive = false; time = 60; weight = 0; errors = 0; usedColors.clear(); sessionHistory = [];
    const conv = document.getElementById("clothes-conveyor");
    if(conv) conv.innerHTML = "";
    for(let i=0;i<3;i++) generateCloth();
  }

  // √âv√©nements boutons
  document.getElementById("btn-google").onclick = () => signInWithPopup(auth, new GoogleAuthProvider());
  document.getElementById("btn-logout").onclick = () => signOut(auth).then(()=>location.reload());
  document.getElementById("finishBtn").onclick = () => finalize(weight>=20.5 && weight<=22 && errors<3);
  
  // Bouton d'√©change
  document.getElementById("btn-exchange").onclick = async () => {
    if(playerData.points < 50) return alert("Pwen ou pa ase!");
    const code = "LAVRI-" + Math.random().toString(36).substring(2, 8).toUpperCase();
    playerData.points -= 50;
    await updateDoc(doc(db, "users", auth.currentUser.uid), { points: playerData.points });
    document.getElementById("balance").textContent = playerData.points;
    alert(`üéüÔ∏è K√íD: ${code}\nMontre sa nan laverie a!`);
  };

</script>
</body>
</html>

</body>
</html>





























